<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
  /**
   * Run initializations on sidebar load.
   */
  $(function() {
    //setup buttons
    $('#sidebar-button-update').click(onUpdateClick);
    $('#sidebar-button-store').click(onStoreClick);    
    
    
  });

/**
 Button Actions
**/
  function onUpdateClick() {
    hideStatus();
    //Get Cursor Parent
    google.script.run
       .withSuccessHandler(function(cursorParent) {
            // Respond to success conditions here.
            refreshInterface(cursorParent[0], cursorParent[1]);
            showStatus("Update Done");
          })
       .withFailureHandler(function(msg) {
            // Respond to failure conditions here.
            showStatus(msg, 'error');
          })
       .getCursorInfo();
  }
  
  function onSetClick() {
    hideStatus();
    //Update Current item
    var indent = document.getElementById('sidebar-indent').value;
    var firstLine = document.getElementById('sidebar-firstLine').value;
    google.script.run
       .withSuccessHandler(function(msg) {
            // Respond to success conditions here.
            showStatus(msg);
          })
       .withFailureHandler(function(msg) {
            // Respond to failure conditions here.
            showStatus(msg, 'error');
          })
       .setIndent(indent, firstLine);
  }
 
  function onStoreClick() {
    hideStatus();
    var indent = document.getElementById('sidebar-indent').value;
    var firstLine = document.getElementById('sidebar-firstLine').value;
    var rootNode = document.getElementById('sidebar-storedList');
    
    var rowNode,cellNode,nodeButton,nodeText, nodeId;
    //Add to root node
    rowNode = document.createElement("div");
      rowNode.setAttribute("class", "row-action");
    rootNode.appendChild(rowNode)
    
    //Add cell
    cellNode = document.createElement("div");
      cellNode.setAttribute("class", "cell");
    rootNode.appendChild(cellNode)
    
    //Set button
    nodeText = "Set ("+indent+","+firstLine+")"
    nodeButton = document.createElement("input");
      nodeButton.type = "button";
      nodeButton.value = nodeText;
      nodeButton.onclick = nodeSet;
      nodeButton.setAttribute("myIndent", indent);
      nodeButton.setAttribute("myFirstLine", firstLine);
      nodeButton.setAttribute("class", "button action");
    cellNode.appendChild(nodeButton);
    
    //Remove Button
    nodeButton = document.createElement("input");
      nodeButton.type = "button";
      nodeButton.value = "Remove";
      nodeButton.onclick = removeLine;
      nodeButton.setAttribute("class", "button");
    cellNode.appendChild(nodeButton);
    
    //Note Text
    nodeText = document.createElement("input");
      nodeText.type = "text";
      nodeText.setAttribute("placeholder", "Note");
      nodeText.setAttribute("class", "note-text");
    cellNode.appendChild(nodeText);
    
    showStatus("Create Button Done");
  }
  

  /**
  Button Controls
  **/
  function removeLine(){
    hideStatus();
    var parent = this.parentNode;
    parent.parentNode.removeChild(parent);
    showStatus("Remove Button Done");
  }
  
  function nodeSet(){
   var indent = this.getAttribute("myIndent");
   var firstLine = this.getAttribute("myFirstLine");
   hideStatus();
    google.script.run
       .withSuccessHandler(function(msg) {
            // Respond to success conditions here.
            showStatus(msg);
          })
       .withFailureHandler(function(msg) {
            // Respond to failure conditions here.
            showStatus(msg, 'error');
          })
       .setIndent(indent, firstLine);
 }


  /**
  Updates Interface
  **/
  function refreshInterface(indent, firstLine){
    $('#sidebar-indent').val(indent);
    $('#sidebar-firstLine').val(firstLine);
  }

  /**
   * Displays the given status message in the sidebar.
   *
   * @param {String} msg The status message to display.
   * @param {String} classId The message type (class id) that the message
   *   should be displayed as.
   */
  function showStatus(msg, classId) {
    $('#sidebar-helper').removeClass("hidden");
    $('#sidebar-status').html(msg);
    if(classId){
      $('#sidebar-status').addClass(classId);
    }
    
  }
  function hideStatus() {
      $('#sidebar-helper').addClass("hidden");
      $('#sidebar-helper').removeClass("error");
  }

</script>
